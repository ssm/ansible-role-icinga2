---
- name: Webserver
  hosts:
    - icinga_master
  roles:
    - role: smbambling.scl
    - role: geerlingguy.apache
    - role: geerlingguy.php
    - role: geerlingguy.apache-php-fpm
  vars:
    php_enable_php_fpm: true
    php_date_timezone: 'UTC'

    # Use SCL version of php
    php_conf_paths: /etc/opt/rh/rh-php71
    php_extension_conf_paths: /etc/opt/rh/rh-php71/php.d/
    php_fpm_daemon: rh-php71-php-fpm.service
    php_packages:
      - rh-php71-php-cli
      - rh-php71-php-fpm
- name: Database
  hosts:
    - icinga_master
  roles:
    - role: geerlingguy.postgresql
  vars:
    postgresql_databases:
      - name: icinga
      - name: icingaweb2
    postgresql_users:
      - name: icinga
        password: icinga
        db: icinga
      - name: icingaweb2
        password: icingaweb2
        db: icingaweb2

- name: Icinga 2
  hosts:
    - icinga_master
    - icinga_satellite
  roles:
    - role: ssm.icinga2
